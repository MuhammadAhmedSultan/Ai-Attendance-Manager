<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Student Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/static/style.css" />
    <style>
      /* Add your existing styles here */

      /* Profile Card */
      .profile-card {
        display: flex;
        align-items: center;
        padding: 20px;
        background: #f0f0f0;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }

      .profile-card img {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        margin-right: 20px;
      }

      .profile-card div h3 {
        margin: 0;
        font-size: 1.2rem;
      }

      /* Calendar Section */
      .calendar-section {
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar">
      <h3>Menu</h3>
      <a href="{{ url_for('student_panel') }}"
        ><i class="fas fa-home"></i> Dashboard</a
      >
       <a href="{{ url_for('student_profile') }}"
        ><i class="fas fa-sign-out-alt"></i> Profile</a
      >
      <a href="{{ url_for('student_courses') }}"
        ><i class="fas fa-book"></i> Courses</a
      >
      <a href="{{ url_for('student_attendance') }}"
        ><i class="fas fa-calendar"></i> Attendance</a
      >
      <a href="{{ url_for('student_messages') }}"
        ><i class="fas fa-envelope"></i> Messages</a
      >
      <a href="{{ url_for('logout') }}"
        ><i class="fas fa-sign-out-alt"></i> Logout</a
      >
    </div>

    <!-- Main Content -->
    <div class="main">
      <div class="header">
        <h1 class=" mb-4">Welcome, {{ student.full_name }}</h1>
      </div>

      <div class="profile-card">
        <img
          src="{{ url_for('static', filename='uploads/' ~ student.image) }}"
          alt="Student Photo"
        />
        <div>
          <h3>{{ student.full_name }}</h3>
          <p>
            Enrollment ID: {{ student.enrollment_id }} | Email: {{student.email
            }}
          </p>
        </div>
      </div>

      <!-- Dashboard Cards -->
      <div class="row">
        <div class="col-md-4 mb-4">
          <div class="card text-white bg-primary h-100">
            <div class="card-body d-flex flex-column justify-content-center align-items-center">
              <i class="fas fa-book fa-3x mb-3"></i>
              <h5 class="card-title">Courses Enrolled</h5>
              <p class="card-text fs-4">{{ student.courses | length }}</p>  
            </div>
          </div>
        </div>


         <!-- Attendance Chart -->
    <div class="chart-container">
      <h3>Attendance Trend</h3>
      <canvas id="attendanceChart" height="100"></canvas>
    </div>

     <script>
    // Display current date in "YYYY-MM-DD" format
    const currentDate = new Date();
    const formattedDate = currentDate.toISOString().split('T')[0];
    document.getElementById('currentDate').textContent = formattedDate;

    // Simulated data for previous dates (example)
    const simulatedData = {
      '2025-09-11': { present: 20, absent: 5, leave: 1 },
      '2025-09-12': { present: 22, absent: 4, leave: 0 },
      '2025-09-15': { present: 25, absent: 3, leave: 1 },
      '2025-09-18': { present: 28, absent: 2, leave: 1 },
      '2025-09-20': { present: 26, absent: 5, leave: 0 }
    };

    // Default values
    const totalClasses = 31;
    let presentClasses = 27;
    let absentClasses = 4;
    let leaveClasses = 0;

    // Update Dashboard Cards based on the selected date
    function updateDashboard() {
      // Use today's data or simulated data as needed
      presentClasses = simulatedData[formattedDate]?.present || 27;
      absentClasses = simulatedData[formattedDate]?.absent || 4;
      leaveClasses = simulatedData[formattedDate]?.leave || 0;

      // Update the content in the dashboard cards
      document.getElementById('totalClasses').textContent = totalClasses;
      document.getElementById('presentClasses').textContent = presentClasses;
      document.getElementById('absentClasses').textContent = absentClasses;
      document.getElementById('leaveClasses').textContent = leaveClasses;

      // Update Attendance Message based on present classes
      const messageContainer = document.getElementById('attendanceMessage');
      if (presentClasses === totalClasses) {
        messageContainer.textContent = "Excellent! You have full attendance ðŸŽ‰";
      } else if (presentClasses / totalClasses >= 0.9) {
        messageContainer.textContent = "Good! Keep it up ðŸ’ª";
      } else if (presentClasses / totalClasses >= 0.75) {
        messageContainer.textContent = "Average! Try to attend more classes";
      } else {
        messageContainer.textContent = "Poor attendance! Focus on attending classes";
      }

      // Optionally, update the attendance chart here based on the selected date
      updateChart();
    }

    // Chart JS
    const ctx = document.getElementById('attendanceChart').getContext('2d');
    let attendanceChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: Array.from({ length: totalClasses }, (_, i) => `2025-09-${(i + 1).toString().padStart(2, '0')}`), // Generate days for September
        datasets: [
          {
            label: 'Present',
            data: Array.from({ length: totalClasses }, (_, i) => (i < presentClasses ? 1 : 0)),
            borderColor: 'green',
            backgroundColor: 'rgba(0,128,0,0.2)',
            fill: true,
            tension: 0.4
          },
          {
            label: 'Absent',
            data: Array.from({ length: totalClasses }, (_, i) => (i >= presentClasses && i < presentClasses + absentClasses ? 1 : 0)),
            borderColor: 'red',
            backgroundColor: 'rgba(255,0,0,0.2)',
            fill: true,
            tension: 0.4
          },
          {
            label: 'Leave',
            data: Array.from({ length: totalClasses }, (_, i) => 0), // No leave days here
            borderColor: 'orange',
            backgroundColor: 'rgba(255,165,0,0.2)',
            fill: true,
            tension: 0.4
          }
        ]
      },
      options: {
        responsive: true,
        plugins: { legend: { position: 'top' } },
        scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
      }
    });

    // Initialize dashboard with today's date
    updateDashboard();
  </script>




